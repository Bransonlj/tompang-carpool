title Invalidate Carpool Request

participantgroup Command
participant RideRequestProcessManager
participant CarpoolCommandHandler
participant CarpoolAggregate
participant EventRepository
end
rparticipant Kafka

participantgroup Query
participant MatchProjector
participant CarpoolQueryRepository
participant RideRequestQueryRepository
end
RideRequestProcessManager->CarpoolCommandHandler:handleInvalidateCarpoolRequest\n(InvalidateCarpoolRequestCommand)
CarpoolCommandHandler->EventRepository:readEvents("carpool", id)
CarpoolCommandHandler<--EventRepository:events: List<CarpoolDomainEvent>
CarpoolCommandHandler->CarpoolAggregate:rehydrate(events)
CarpoolCommandHandler<--CarpoolAggregate:carpoolAggregate
CarpoolCommandHandler->CarpoolAggregate:invalidateRequestToCarpool(InvalidateCarpoolRequestCommand)
CarpoolCommandHandler->CarpoolAggregate:getUncommittedChanges()
CarpoolCommandHandler<--CarpoolAggregate:CarpoolRequestInvalidatedEvent
destroy CarpoolAggregate
CarpoolCommandHandler->EventRepository:appendEvents(CarpoolRequestInvalidatedEvent)
CarpoolCommandHandler->Kafka:CarpoolRequestInvalidatedEvent
Kafka->MatchProjector:CarpoolRequestInvalidatedEvent
MatchProjector->CarpoolQueryRepository:findById(id)
MatchProjector<--CarpoolQueryRepository:carpool
MatchProjector->RideRequestQueryRepository:findById(id)
MatchProjector<--RideRequestQueryRepository:rideRequest
MatchProjector->MatchProjector:remove carpool & ride request \n from each other
MatchProjector->CarpoolQueryRepository:save(carpool)
MatchProjector->RideRequestQueryRepository:save(rideRequest)